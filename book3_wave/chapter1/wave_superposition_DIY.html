<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>Two Pulses Superposition / å…©è„ˆè¡ç–ŠåŠ </title>

<!-- ================== STYLE ================== -->
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    h1 {
        font-size: 20px;
        margin: 16px 0 8px 0;
        text-align: center;
    }

    .container {
        margin: 8px;
        padding: 12px 16px;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        max-width: 900px;
        width: 100%;
        box-sizing: border-box;
    }

    canvas {
        display: block;
        margin: 0 auto 12px auto;
        background: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 8px;
        width: 800px;
        height: 120px;
    }

    .info {
        font-size: 13px;
        color: #444;
        text-align: center;
        margin-bottom: 6px;
    }

    .legend {
        display: flex;
        justify-content: center;
        gap: 12px;
        font-size: 13px;
        margin-bottom: 6px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .legend-line {
        width: 30px;
        height: 4px;
        border-radius: 2px;
    }

    .legend-line.a { 
        background: #0066ff;
        height: 3px;
    }
    
    .legend-line.b { 
        background: rgba(255, 102, 0, 0.5);
        height: 5px;
    }
    
    .legend-line.sum { 
        background: rgba(0,180,0,0.8);
        height: 4px;
    }

    .controls {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: center;
        font-size: 13px;
        margin-bottom: 6px;
    }

    .controls-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 12px;
        align-items: center;
        justify-content: center;
    }

    button {
        padding: 5px 12px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.15s ease;
    }

    .primary-btn {
        background: #005bbb;
        color: #ffffff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    .secondary-btn {
        background: #e0e0e0;
        color: #333333;
    }

    button:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0,0,0,0.24);
    }

    button:active {
        transform: translateY(1px);
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    label {
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    select {
        padding: 4px 8px;
        border-radius: 8px;
        border: 1px solid #cccccc;
        font-size: 13px;
        background: #ffffff;
    }

    input[type="range"] {
        width: 260px;
    }

    .step-buttons button {
        min-width: 52px;
    }

    .checkbox-row label {
        margin: 0 4px;
    }

    .usage-hint {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 8px 12px;
        margin: 8px 0;
        font-size: 12px;
        color: #1565c0;
        border-radius: 4px;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Two Pulses Superposition / å…©è„ˆè¡ç–ŠåŠ </h1>

    <div class="info">
        é¸æ“‡æ³¢å½¢çµ„åˆå¾Œæ’­æ”¾æˆ–æ‹–æ›³æ™‚é–“ã€‚é è¨­ï¼šA æ³¢å·¦ç§»ä¸‰è§’æ³¢ã€B æ³¢å³ç§»æ–¹æ³¢ã€‚<br>
        v<sub>A</sub> = 1 grid/s to the rightï¼ˆå‘å³ 1 æ ¼/ç§’ï¼‰ï¼Œ
        v<sub>B</sub> = 1 grid/s to the leftï¼ˆå‘å·¦ 1 æ ¼/ç§’ï¼‰
    </div>

    <div class="usage-hint">
        ğŸ’¡ <strong>ä½¿ç”¨æç¤º</strong>ï¼šé»æ“Š t = 0ã€1ã€2... æŒ‰éˆ•å¯ç›´æ¥åˆ‡æ›åˆ°è©²æ™‚åˆ»ä¸¦æš«åœï¼Œæ–¹ä¾¿è§€å¯Ÿæ³¢å½¢è®ŠåŒ–
    </div>

    <div class="legend">
        <span class="legend-item">
            <span class="legend-line a"></span>
            A wave / A æ³¢ï¼ˆå·¦ç§»ï¼Œè—è‰²ç´°ç·šï¼‰
        </span>
        <span class="legend-item">
            <span class="legend-line b"></span>
            B wave / B æ³¢ï¼ˆå³ç§»ï¼Œæ©˜è‰²ç²—ç·šåŠé€æ˜ï¼‰
        </span>
        <span class="legend-item">
            <span class="legend-line sum"></span>
            A + B / ç–ŠåŠ æ³¢ï¼ˆç¶ è‰²å¯¦ç·šï¼‰
        </span>
    </div>

    <canvas id="waveCanvas" width="800" height="120"></canvas>

    <div class="controls">
        <!-- æ³¢å½¢çµ„åˆé¸æ“‡ -->
        <div class="controls-row">
            <label for="presetSelect">Wave preset / æ³¢å½¢çµ„åˆ:</label>
            <select id="presetSelect">
                <option value="square-triangle">Square + Triangle</option>
                <option value="triangle-triangle">Triangle + Triangle</option>
                <option value="triangle-triangle-2">Triangle + Triangle 2</option>
            </select>
        </div>

        <!-- ç¬¬ä¸€åˆ—ï¼šæ’­æ”¾æ§åˆ¶ -->
        <div class="controls-row">
            <button id="playPauseBtn" class="primary-btn">æ’­æ”¾ Play</button>
            <button id="resetBtn" class="secondary-btn">é‡è¨­ t = 0</button>
        </div>

        <!-- ç¬¬äºŒåˆ—ï¼šæ•´æ•¸ç§’æ­¥é€² -->
        <div class="controls-row step-buttons">
            <span>æ•´æ•¸ç§’ / Integer seconds:</span>
            <button data-t="0" class="secondary-btn">t = 0 s</button>
            <button data-t="1" class="secondary-btn">1 s</button>
            <button data-t="2" class="secondary-btn">2 s</button>
            <button data-t="3" class="secondary-btn">3 s</button>
            <button data-t="4" class="secondary-btn">4 s</button>
            <button data-t="5" class="secondary-btn">5 s</button>
            <button data-t="6" class="secondary-btn">6 s</button>
            <button id="stepBackBtn" class="secondary-btn">â†º ä¸Šä¸€ç§’ / prev</button>
            <button id="stepForwardBtn" class="secondary-btn">â†» ä¸‹ä¸€ç§’ / next</button>
        </div>

        <!-- ç¬¬ä¸‰åˆ—ï¼šé€£çºŒæ™‚é–“æ»‘æ¡¿ -->
        <div class="controls-row">
            <label>
                æ™‚é–“ Time:
                <input type="range" id="timeSlider" min="0" max="10" step="0.01" value="0">
            </label>
            <span id="timeLabel">t = 0.00 s</span>
        </div>

        <!-- ç¬¬å››åˆ—ï¼šé¡¯ç¤ºé¸é … -->
        <div class="controls-row checkbox-row">
            <label>
                <input type="checkbox" id="showA">
                é¡¯ç¤º A æ³¢ / show A
            </label>
            <label>
                <input type="checkbox" id="showB">
                é¡¯ç¤º B æ³¢ / show B
            </label>
            <label>
                <input type="checkbox" id="showSum" checked>
                é¡¯ç¤º A+B / show A+B
            </label>
        </div>
    </div>
</div>

<!-- ================== SCRIPT ================== -->
<script>
/* ============================================================
 * CONSTANTS & CONFIG
 * ============================================================ */
const canvas = document.getElementById("waveCanvas");
const ctx = canvas.getContext("2d");

// ç©ºé–“ç¯„åœ
const X_MIN = -20;
const X_MAX = 20;
const Y_MIN = -3;
const Y_MAX = 3;

// æ™‚é–“èˆ‡é€Ÿåº¦
const MAX_T = 10;
const SPEED_A = 1;  // å‘å³
const SPEED_B = 1;  // å‘å·¦

// æ ¼ç·šé–“è·
const GRID_SPACING_X = 1;
const GRID_SPACING_Y = 1;

// ç¹ªåœ–åƒæ•¸
const SAMPLE_POINTS = 400;  // å„ªåŒ–ï¼šå¾ 1000 é™åˆ° 400ï¼Œè¶³å¤ å¹³æ»‘
const COLORS = {
    waveA: "#0066ff",
    waveB: "rgba(255, 102, 0, 0.5)",
    sum: "rgba(0, 180, 0, 0.8)"
};
const LINE_WIDTH = {
    waveA: 2,
    waveB: 4,
    sum: 3.5
};

// é å…ˆè¨ˆç®—åº§æ¨™è½‰æ›æ¯”ä¾‹ï¼ˆå„ªåŒ–ï¼šé¿å…é‡è¤‡è¨ˆç®—ï¼‰
const SCALE_X = canvas.width / (X_MAX - X_MIN);
const SCALE_Y = canvas.height / (Y_MAX - Y_MIN);
const DEFAULT_PRESET = "square-triangle";

/* ============================================================
 * STATE
 * ============================================================ */
const state = {
    t: 0,
    playing: false,
    lastTimestamp: null,
    presetId: DEFAULT_PRESET,
    showA: false,      // é è¨­ä¸é¡¯ç¤º A æ³¢
    showB: false,      // é è¨­ä¸é¡¯ç¤º B æ³¢
    showSum: true      // é è¨­åªé¡¯ç¤ºç–ŠåŠ æ³¢
};

/* ============================================================
 * PHYSICS - æ³¢å½¢å®šç¾©
 * ============================================================ */

// ç”¢ç”Ÿä¸‰è§’æ³¢ï¼Œheight å¯æ­£ï¼ˆå°–æœä¸Šï¼‰æˆ–è² ï¼ˆå°–æœä¸‹ï¼‰
function makeTriangle(start, peak, end, height) {
    return function (x) {
        if (x < start || x > end) return 0;
        if (x <= peak) {
            return ((x - start) / (peak - start)) * height;
        }
        return ((end - x) / (end - peak)) * height;
    };
}

const wavePresets = {
    "square-triangle": {
        // A å¾€å³å¹³ç§» 1 æ ¼ï¼šåŸæœ¬ [-5,-3,-1] â†’ [-4,-2,0]
        shapeA0: makeTriangle(-4, -2, 0, 1),
        shapeB0: function (x) {
            if (x >= 1 && x < 3) return -1;
            if (x >= 3 && x <= 5) return 2;
            return 0;
        }
    },
    "triangle-triangle": {
        shapeA0: makeTriangle(-5, -3, -1, 1.2),
        shapeB0: makeTriangle(1, 2, 3, -3)
    },
    "triangle-triangle-2": {
        // Aï¼šä¸‰æ®µæŠ˜ç·šï¼ˆèµ·é» 0 â†’ è°·åº• -1 â†’ é ‚é» 1.2 â†’ å›åˆ° 0ï¼‰
        shapeA0: function (x) {
            const x0 = -10, x1 = -8, x2 = -2, x3 = 1;
            if (x < x0 || x > x3) return 0;
            if (x <= x1) return ((x - x0) / (x1 - x0)) * (-1);          // 0 â†’ -1
            if (x <= x2) return ((x - x1) / (x2 - x1)) * (1.2 + 1) - 1; // -1 â†’ 1.2
            return ((x3 - x) / (x3 - x2)) * 1.2;                       // 1.2 â†’ 0
        },
        shapeB0: makeTriangle(4, 7, 9, -3)
    }
};

let shapeA0 = wavePresets[DEFAULT_PRESET].shapeA0;
let shapeB0 = wavePresets[DEFAULT_PRESET].shapeB0;

// t æ™‚åˆ»çš„æ³¢å½¢ï¼ˆä½¿ç”¨è¡Œæ³¢æ–¹ç¨‹ï¼‰
const waveA = (x, t) => shapeA0(x - SPEED_A * t);
const waveB = (x, t) => shapeB0(x + SPEED_B * t);

/* ============================================================
 * ANIMATION
 * ============================================================ */
function updateState(dt) {
    if (!state.playing) return;
    state.t += dt;
    if (state.t > MAX_T) state.t = 0;
}

/* ============================================================
 * RENDER - åº§æ¨™è½‰æ›ï¼ˆå„ªåŒ–ç‰ˆï¼‰
 * ============================================================ */
const xToPx = (x) => (x - X_MIN) * SCALE_X;
const yToPx = (y) => canvas.height - (y - Y_MIN) * SCALE_Y;

/* ============================================================
 * RENDER - æ ¼ç·šèˆ‡åº§æ¨™è»¸
 * ============================================================ */
function drawGridAndAxes() {
    const w = canvas.width;
    const h = canvas.height;

    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, w, h);

    // æ ¼ç·š
    ctx.lineWidth = 0.5;
    ctx.strokeStyle = "#e0e0e0";
    ctx.beginPath();
    
    for (let x = Math.ceil(X_MIN); x <= X_MAX; x += GRID_SPACING_X) {
        const px = xToPx(x);
        ctx.moveTo(px, 0);
        ctx.lineTo(px, h);
    }
    for (let y = Math.ceil(Y_MIN); y <= Y_MAX; y += GRID_SPACING_Y) {
        const py = yToPx(y);
        ctx.moveTo(0, py);
        ctx.lineTo(w, py);
    }
    ctx.stroke();

    // x è»¸ï¼ˆy = 0ï¼‰
    const y0 = yToPx(0);
    ctx.lineWidth = 1.2;
    ctx.strokeStyle = "#e0e0e0";
    ctx.beginPath();
    ctx.moveTo(0, y0);
    ctx.lineTo(w, y0);
    ctx.stroke();

    // å‚ç›´åƒè€ƒç·šï¼ˆx = 0ï¼‰
    const x0 = xToPx(0);
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#888888";
    ctx.beginPath();
    ctx.moveTo(x0, 0);
    ctx.lineTo(x0, h);
    ctx.stroke();
}

/* ============================================================
 * RENDER - æ³¢å½¢ç¹ªè£½ï¼ˆå„ªåŒ–ç‰ˆï¼‰
 * ============================================================ */
function drawWave(color, lineWidth, sampleFunc) {
    ctx.save();
    ctx.lineWidth = lineWidth;
    ctx.strokeStyle = color;
    ctx.beginPath();

    const dx = (X_MAX - X_MIN) / SAMPLE_POINTS;
    
    for (let i = 0; i <= SAMPLE_POINTS; i++) {
        const x = X_MIN + i * dx;
        const y = sampleFunc(x);
        const px = xToPx(x);
        const py = yToPx(y);

        if (i === 0) {
            ctx.moveTo(px, py);
        } else {
            ctx.lineTo(px, py);
        }
    }

    ctx.stroke();
    ctx.restore();
}

/* ============================================================
 * RENDER - ä¸»æ¸²æŸ“å‡½æ•¸
 * ============================================================ */
function render() {
    drawGridAndAxes();
    const t = state.t;

    // ç¹ªè£½é †åºï¼šå…ˆç•«å€‹åˆ¥æ³¢ï¼Œå†ç•«ç–ŠåŠ æ³¢ï¼ˆè®“ç–ŠåŠ æ³¢åœ¨æœ€ä¸Šå±¤ï¼‰
    if (state.showA) {
        drawWave(COLORS.waveA, LINE_WIDTH.waveA, (x) => waveA(x, t));
    }

    if (state.showB) {
        drawWave(COLORS.waveB, LINE_WIDTH.waveB, (x) => waveB(x, t));
    }

    if (state.showSum) {
        drawWave(COLORS.sum, LINE_WIDTH.sum, (x) => waveA(x, t) + waveB(x, t));
    }

    // æ™‚é–“æ¨™ç±¤
    ctx.save();
    ctx.fillStyle = "#222222";
    ctx.font = "14px system-ui";
    ctx.fillText(`t = ${t.toFixed(2)} s`, 12, 18);
    ctx.restore();
}

/* ============================================================
 * UI CONTROLS
 * ============================================================ */
const presetSelect = document.getElementById("presetSelect");
const playPauseBtn = document.getElementById("playPauseBtn");
const resetBtn = document.getElementById("resetBtn");
const stepBackBtn = document.getElementById("stepBackBtn");
const stepForwardBtn = document.getElementById("stepForwardBtn");
const timeSlider = document.getElementById("timeSlider");
const timeLabel = document.getElementById("timeLabel");
const showABox = document.getElementById("showA");
const showBBox = document.getElementById("showB");
const showSumBox = document.getElementById("showSum");

presetSelect.value = state.presetId;
presetSelect.addEventListener("change", () => {
    applyPreset(presetSelect.value);
});

// æ’­æ”¾ / æš«åœ
playPauseBtn.addEventListener("click", () => {
    state.playing = !state.playing;
    if (state.playing) {
        state.lastTimestamp = null;
        playPauseBtn.textContent = "æš«åœ Pause";
    } else {
        playPauseBtn.textContent = "æ’­æ”¾ Play";
    }
});

// é‡è¨­ t = 0
resetBtn.addEventListener("click", () => {
    setTime(0);
    pauseAnimation();
});

// é€£çºŒæ™‚é–“æ»‘æ¡¿
timeSlider.addEventListener("input", () => {
    const val = parseFloat(timeSlider.value);
    state.t = val;
    updateTimeLabel();
    render();
});

// é¡¯ç¤ºé¸é …
showABox.addEventListener("change", () => {
    state.showA = showABox.checked;
    render();
});
showBBox.addEventListener("change", () => {
    state.showB = showBBox.checked;
    render();
});
showSumBox.addEventListener("change", () => {
    state.showSum = showSumBox.checked;
    render();
});

// æ•´æ•¸ç§’æŒ‰éˆ•ï¼ˆé»æ“Šå¾Œæš«åœï¼‰
document.querySelectorAll(".step-buttons button[data-t]").forEach(btn => {
    btn.addEventListener("click", () => {
        const t = parseInt(btn.getAttribute("data-t"), 10);
        setTime(t);
        pauseAnimation();  // é—œéµï¼šé»æ“Šæ•´æ•¸ç§’å¾Œæš«åœ
    });
});

// ä¸Šä¸€ç§’ / ä¸‹ä¸€ç§’
stepBackBtn.addEventListener("click", () => {
    const tInt = Math.round(state.t);
    const tNew = Math.max(0, tInt - 1);
    setTime(tNew);
    pauseAnimation();
});

stepForwardBtn.addEventListener("click", () => {
    const tInt = Math.round(state.t);
    const tNew = Math.min(6, tInt + 1);
    setTime(tNew);
    pauseAnimation();
});

// è¼”åŠ©å‡½æ•¸
function applyPreset(presetId) {
    const preset = wavePresets[presetId];
    if (!preset) return;
    state.presetId = presetId;
    shapeA0 = preset.shapeA0;
    shapeB0 = preset.shapeB0;
    setTime(0);
    pauseAnimation();
}

function setTime(t) {
    state.t = t;
    timeSlider.value = t.toFixed(2);
    updateTimeLabel();
    render();
}

function updateTimeLabel() {
    timeLabel.textContent = `t = ${state.t.toFixed(2)} s`;
}

function pauseAnimation() {
    state.playing = false;
    playPauseBtn.textContent = "æ’­æ”¾ Play";
}

/* ============================================================
 * ANIMATION LOOP
 * ============================================================ */
function loop(timestamp) {
    if (state.lastTimestamp == null) {
        state.lastTimestamp = timestamp;
    }
    const dt_ms = timestamp - state.lastTimestamp;
    state.lastTimestamp = timestamp;

    const dt = dt_ms / 1000;  // è½‰æ›ç‚ºç§’

    updateState(dt);

    if (state.playing) {
        timeSlider.value = state.t.toFixed(2);
        updateTimeLabel();
    }

    render();
    window.requestAnimationFrame(loop);
}

/* ============================================================
 * INITIALIZATION
 * ============================================================ */
updateTimeLabel();
render();
window.requestAnimationFrame(loop);
</script>
</body>
</html>
