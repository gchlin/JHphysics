<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>Two Pulses Superposition / 兩道波疊加</title>

<!-- ================== STYLE ================== -->
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    h1 {
        font-size: 20px;
        margin: 16px 0 8px 0;
        text-align: center;
    }

    .container {
        margin: 8px;
        padding: 12px 16px;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        max-width: 900px;
        width: 100%;
        box-sizing: border-box;
    }

    /* 畫布：寬 800 px；為了讓格子近似正方形，配合 x 範圍 -20~20 共 40 單位
       取 1 單位 ≈ 20 px，則 y 範圍 -3~3 共 6 單位，高度 ≈ 120 px */
    canvas {
        display: block;
        margin: 0 auto 12px auto;
        background: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 8px;
        width: 800px;
        height: 120px;
    }

    .info {
        font-size: 13px;
        color: #444;
        text-align: center;
        margin-bottom: 6px;
    }

    .legend {
        display: flex;
        justify-content: center;
        gap: 12px;
        font-size: 13px;
        margin-bottom: 6px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .legend-color {
        width: 18px;
        height: 4px;
        border-radius: 2px;
    }

    .legend-color.a { background: #00ffff; }           /* cyan */
    .legend-color.b { background: #ffff00; }           /* yellow */
    .legend-color.sum { background: rgba(0,180,0,0.7); } /* green, semi-transparent */

    .controls {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: center;
        font-size: 13px;
        margin-bottom: 6px;
    }

    .controls-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 12px;
        align-items: center;
        justify-content: center;
    }

    button {
        padding: 5px 12px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 13px;
    }

    .primary-btn {
        background: #005bbb;
        color: #ffffff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    .secondary-btn {
        background: #e0e0e0;
        color: #333333;
    }

    button:active {
        transform: translateY(1px);
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    label {
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    input[type="range"] {
        width: 260px;
    }

    .step-buttons button {
        min-width: 52px;
    }

    .checkbox-row label {
        margin: 0 4px;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Two Pulses Superposition / 兩道波疊加</h1>

    <div class="info">
        A wave：left triangle pulse / 左側三角波<br>
        B wave：right square pulse / 右側方波<br>
        v<sub>A</sub> = 1 grid/s to the right（向右 1 格/秒），
        v<sub>B</sub> = 1 grid/s to the left（向左 1 格/秒）<br>
        Focus on integer time t = 0, 1, 2, 3, 4, 5 s（整數秒可用下方按鈕）
    </div>

    <div class="legend">
        <span class="legend-item">
            <span class="legend-color a"></span>
            A wave / A 波（三角形，cyan）
        </span>
        <span class="legend-item">
            <span class="legend-color b"></span>
            B wave / B 波（方形，yellow）
        </span>
        <span class="legend-item">
            <span class="legend-color sum"></span>
            A + B / 疊加波（半透明綠色）
        </span>
    </div>

    <canvas id="waveCanvas" width="800" height="120"></canvas>

    <div class="controls">
        <!-- 第一列：播放控制 -->
        <div class="controls-row">
            <button id="playPauseBtn" class="primary-btn">播放 Play</button>
            <button id="resetBtn" class="secondary-btn">重設 t = 0</button>
        </div>

        <!-- 第二列：整數秒步進 -->
        <div class="controls-row step-buttons">
            <span>整數秒 / Integer seconds:</span>
            <button data-t="0" class="secondary-btn">t = 0 s</button>
            <button data-t="1" class="secondary-btn">1 s</button>
            <button data-t="2" class="secondary-btn">2 s</button>
            <button data-t="3" class="secondary-btn">3 s</button>
            <button data-t="4" class="secondary-btn">4 s</button>
            <button data-t="5" class="secondary-btn">5 s</button>
            <button id="stepBackBtn" class="secondary-btn">↺ 上一秒 / prev</button>
            <button id="stepForwardBtn" class="secondary-btn">↻ 下一秒 / next</button>
        </div>

        <!-- 第三列：連續時間滑桿 -->
        <div class="controls-row">
            <label>
                時間 Time:
                <input type="range" id="timeSlider" min="0" max="10" step="0.01" value="0">
            </label>
            <span id="timeLabel">t = 0.00 s</span>
        </div>

        <!-- 第四列：顯示選項 -->
        <div class="controls-row checkbox-row">
            <label>
                <input type="checkbox" id="showA" checked>
                顯示 A 波 / show A
            </label>
            <label>
                <input type="checkbox" id="showB" checked>
                顯示 B 波 / show B
            </label>
            <label>
                <input type="checkbox" id="showSum" checked>
                顯示 A+B / show A+B
            </label>
        </div>
    </div>
</div>

<!-- ================== SCRIPT ================== -->
<script>
/* ============================================================
 * CONFIG
 * ============================================================ */
const canvas = document.getElementById("waveCanvas");
const ctx = canvas.getContext("2d");

/* 空間範圍
 *   x：-20 ~ 20（40 單位）
 *   y：-3  ~ 3 （6 單位）
 * 搭配 canvas 800×120，可讓格線近似正方形。
 */
const X_MIN = -20;
const X_MAX =  20;
const Y_MIN =  -3;
const Y_MAX =   3;

const MAX_T = 10;     // 連續時間上限（滑桿）
const SPEED_A = 1;    // A 波速度 1 格/秒，向右
const SPEED_B = 1;    // B 波速度 1 格/秒，向左（在函數中用 x + v t）

const gridSpacingX = 1;
const gridSpacingY = 1;

/* ============================================================
 * STATE
 * ============================================================ */
const state = {
    t: 0,
    playing: false,
    lastTimestamp: null,
    showA: true,
    showB: true,
    showSum: true
};

/* ============================================================
 * PHYSICS
 *  t = 0 時波形：
 *  A（三角波）：底邊長 4 單位、高 1 單位，整體往右平移 9 單位
 *      底邊 x ∈ [-5, -1]，峰值在 x = -3、振幅 1
 *  B（方波）：原本 [6,8)/[8,10]，整體往左平移 5 單位
 *      x ∈ [1,3)  位移 -1
 *      x ∈ [3,5]  位移 +2
 * ============================================================ */

/* A wave at t = 0
 * (-5,0) → (-3,1) → (-1,0)
 */
function shapeA0(x) {
    const amp = 1;
    if (x < -5 || x > -1) return 0;

    if (x <= -3) {
        // 左半邊：線性上升
        // x=-5 → 0，x=-3 → 1
        return amp * ((x + 5) / 2);
    } else {
        // 右半邊：線性下降
        // x=-3 → 1，x=-1 → 0
        return amp * ((-1 - x) / 2);
    }
}

/* B wave at t = 0
 * x ∈ [1,3) ：-1
 * x ∈ [3,5]：+2
 */
function shapeB0(x) {
    if (x >= 1 && x < 3) {
        return -1;
    } else if (x >= 3 && x <= 5) {
        return 2;
    } else {
        return 0;
    }
}

// t 時刻 A 波：右移 f(x - v t)
function waveA(x, t) {
    return shapeA0(x - SPEED_A * t);
}

// t 時刻 B 波：左移 f(x + v t)
function waveB(x, t) {
    return shapeB0(x + SPEED_B * t);
}

/* ============================================================
 * INTEGRATOR
 * ============================================================ */
function updateState(dt) {
    if (!state.playing) return;
    state.t += dt;
    if (state.t > MAX_T) state.t = 0;
}

/* ============================================================
 * RENDER
 * ============================================================ */
function xToPx(x) {
    const w = canvas.width;
    return ((x - X_MIN) / (X_MAX - X_MIN)) * w;
}

function yToPx(y) {
    const h = canvas.height;
    return h - ((y - Y_MIN) / (Y_MAX - Y_MIN)) * h;
}

function drawGridAndAxes() {
    const w = canvas.width;
    const h = canvas.height;

    ctx.save();
    ctx.clearRect(0, 0, w, h);

    // 背景
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, w, h);

    // 格線
    ctx.lineWidth = 0.5;
    ctx.strokeStyle = "#e0e0e0";
    ctx.beginPath();

    for (let x = Math.ceil(X_MIN); x <= X_MAX; x += gridSpacingX) {
        const px = xToPx(x);
        ctx.moveTo(px, 0);
        ctx.lineTo(px, h);
    }
    for (let y = Math.ceil(Y_MIN); y <= Y_MAX; y += gridSpacingY) {
        const py = yToPx(y);
        ctx.moveTo(0, py);
        ctx.lineTo(w, py);
    }
    ctx.stroke();

    // x 軸（y = 0）
    const y0 = yToPx(0);
    ctx.lineWidth = 1.2;
    ctx.strokeStyle = "#e0e0e0";
    ctx.beginPath();
    ctx.moveTo(0, y0);
    ctx.lineTo(w, y0);
    ctx.stroke();

    // 垂直參考線 x = 0
    const x0 = xToPx(0);
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#888888";
    ctx.beginPath();
    ctx.moveTo(x0, 0);
    ctx.lineTo(x0, h);
    ctx.stroke();

    ctx.restore();
}

function drawWave(color, lineWidth, sampleFunc) {
    const N = 1000;
    ctx.save();
    ctx.lineWidth = lineWidth;
    ctx.strokeStyle = color;
    ctx.beginPath();

    for (let i = 0; i <= N; i++) {
        const alpha = i / N;
        const x = X_MIN + alpha * (X_MAX - X_MIN);
        const y = sampleFunc(x);
        const px = xToPx(x);
        const py = yToPx(y);

        if (i === 0) {
            ctx.moveTo(px, py);
        } else {
            ctx.lineTo(px, py);
        }
    }

    ctx.stroke();
    ctx.restore();
}

function render() {
    drawGridAndAxes();
    const t = state.t;

    // A 波：cyan
    if (state.showA) {
        drawWave("#00ffff", 2, (x) => waveA(x, t));
    }

    // B 波：yellow（不再 y shift）
    if (state.showB) {
        drawWave("#ffff00", 2, (x) => waveB(x, t));
    }

    // 疊加波：半透明綠色
    if (state.showSum) {
        drawWave("rgba(0,180,0,0.7)", 3, (x) => waveA(x, t) + waveB(x, t));
    }

    // 時間標籤
    ctx.save();
    ctx.fillStyle = "#222222";
    ctx.font = "14px system-ui";
    ctx.fillText(`t = ${t.toFixed(2)} s`, 12, 18);
    ctx.restore();
}

/* ============================================================
 * UI
 * ============================================================ */
const playPauseBtn   = document.getElementById("playPauseBtn");
const resetBtn       = document.getElementById("resetBtn");
const stepBackBtn    = document.getElementById("stepBackBtn");
const stepForwardBtn = document.getElementById("stepForwardBtn");
const timeSlider     = document.getElementById("timeSlider");
const timeLabel      = document.getElementById("timeLabel");
const showABox       = document.getElementById("showA");
const showBBox       = document.getElementById("showB");
const showSumBox     = document.getElementById("showSum");

// 播放 / 暫停
playPauseBtn.addEventListener("click", () => {
    state.playing = !state.playing;
    if (state.playing) {
        state.lastTimestamp = null;
        playPauseBtn.textContent = "暫停 Pause";
    } else {
        playPauseBtn.textContent = "播放 Play";
    }
});

// 重設 t = 0
resetBtn.addEventListener("click", () => {
    setTime(0);
});

// 連續時間滑桿
timeSlider.addEventListener("input", () => {
    const val = parseFloat(timeSlider.value);
    state.t = val;
    updateTimeLabel();
    render();
});

// 顯示選項
showABox.addEventListener("change", () => {
    state.showA = showABox.checked;
    render();
});
showBBox.addEventListener("change", () => {
    state.showB = showBBox.checked;
    render();
});
showSumBox.addEventListener("change", () => {
    state.showSum = showSumBox.checked;
    render();
});

// 整數秒按鈕 0~5
document.querySelectorAll(".step-buttons button[data-t]").forEach(btn => {
    btn.addEventListener("click", () => {
        const t = parseInt(btn.getAttribute("data-t"), 10);
        setTime(t);
    });
});

// 上一秒 / 下一秒（限制在 0~5）
stepBackBtn.addEventListener("click", () => {
    const tInt = Math.round(state.t);
    const tNew = Math.max(0, tInt - 1);
    setTime(tNew);
});
stepForwardBtn.addEventListener("click", () => {
    const tInt = Math.round(state.t);
    const tNew = Math.min(5, tInt + 1);
    setTime(tNew);
});

function setTime(t) {
    state.t = t;
    timeSlider.value = t.toFixed(2);
    updateTimeLabel();
    render();
}

function updateTimeLabel() {
    timeLabel.textContent = `t = ${state.t.toFixed(2)} s`;
}

/* ============================================================
 * LOOP
 * ============================================================ */
function loop(timestamp) {
    if (state.lastTimestamp == null) {
        state.lastTimestamp = timestamp;
    }
    const dt_ms = timestamp - state.lastTimestamp;
    state.lastTimestamp = timestamp;

    const dt = dt_ms / 1000;  // 秒

    updateState(dt);

    if (state.playing) {
        timeSlider.value = state.t.toFixed(2);
        updateTimeLabel();
    }

    render();
    window.requestAnimationFrame(loop);
}

// 初始化
updateTimeLabel();
render();
window.requestAnimationFrame(loop);
</script>
</body>
</html>
